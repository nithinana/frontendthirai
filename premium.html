<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Access Required</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
    
    <!-- Custom CSS copied from player.html unlock screen for identical appearance -->
    <style>
        /* Base Styles for the entire page */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden; 
            height: 100%;
            width: 100%;
            font-family: Arial, sans-serif;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* --- Global Styles: PERMANENT DARK MODE --- */

        body {
            background-color: #121212; /* Dark mode background */
            color: #e0e0e0; /* Dark mode text color */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* --- UNLOCK SCREEN STYLES (FROM player.html) --- */

        #unlock-screen {
            display: flex; /* Always show the unlock screen initially */
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            flex-direction: column;
            position: absolute; 
            top: 0; left: 0;
            background-color: #121212; 
            z-index: 999; 
            /* Added transition for fade-out effect */
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }

        /* New class for fade-out */
        #unlock-screen.fade-out {
            opacity: 0;
            visibility: hidden;
        }
        
        .container {
            text-align: center;
            background-color: #111; /* Match player.html container background */
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); /* Match player.html shadow */
            max-width: 90%;
            width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color 0.5s ease, box-shadow 0.5s ease; 
        }
        
        #logo {
            max-width: 175px;
            margin-bottom: 12px;
        }

        #unlock-screen h2 {
            color: #ffffff;
            font-size: 1.5em; /* Adjusted to match visual size */
            margin-bottom: 25px; /* Added margin for separation */
        }
        
        /* Input fields and container */
        .code-input-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .code-input {
            width: 40px;
            height: 50px;
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            color: #fff; /* White text */
            background-color: #222; /* Dark input background */
            border: 2px solid #333; /* Darker border */
            border-radius: 8px;
            outline: none;
            transition: border-color 0.2s ease, background-color 0.5s ease, color 0.5s ease;
        }
        
        .code-input:focus {
            border-color: #0d6efd;
        }

        /* Input Autofill Styling for Dark Mode */
        input::-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #222 inset !important; 
            -webkit-text-fill-color: #fff !important; 
        }
        
        /* Join Button styles */
        .join-button {
            width: 100%;
            padding: 15px;
            background-color: #0d6efd;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-bottom: 0; /* Removed extra bottom margin */
        }
        
        .join-button:hover {
            background-color: #0b5ed7; /* Darken slightly on hover */
        }

        .join-button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        #error-message {
            color: #dc3545;
            font-size: 0.9em;
            display: none;
            margin-top: 25px;
            text-align: center;
        }

        /* --- NEW: Success Animation Styles --- */
        #success-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #121212;
            display: none; /* Hidden until success */
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }

        .check-container {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #1e7e34; /* Green */
            display: flex;
            justify-content: center;
            align-items: center;
            transform: scale(0);
            animation: grow 0.3s ease-out forwards;
        }

        .check-icon {
            color: #fff;
            font-size: 60px;
            opacity: 0;
            animation: fadeInTick 0.3s 0.3s forwards; /* Start after container grows */
        }
        
        @keyframes grow {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        @keyframes fadeInTick {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    
    <!-- Lock Screen / PIN Entry (Structure copied from player.html) -->
    <div id="unlock-screen">
        <div class="container">
            <!-- Note: You will need to ensure 'static/thiraiwhite.png' is available for the logo to display -->
            <img id="logo" src="./static/thiraiwhite.png" alt="App Logo"> 
            <h2>Enter the Premium Code</h2>
            
            <div class="code-input-container" id="codeInputContainer">
                <input type="text" class="code-input" id="code1" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="off" autocapitalize="none">
                <input type="text" class="code-input" id="code2" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="off" autocapitalize="none">
                <input type="text" class="code-input" id="code3" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="off" autocapitalize="none">
                <input type="text" class="code-input" id="code4" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="off" autocapitalize="none">
            </div>
            
            <button class="join-button" id="unlockButton" disabled>Unlock Access</button>
            <div id="error-message"></div>
        </div>
    </div>

    <!-- NEW: Success Overlay for Tick Animation and Fade -->
    <div id="success-overlay">
        <div class="check-container">
            <i class="bi bi-check-lg check-icon"></i>
        </div>
        <p style="margin-top: 30px; font-size: 1.2em;">Access Granted!</p>
    </div>

    <script>
        (function() { 
            // --- CONFIGURATION ---
            const CORRECT_PIN = "1451"; // The secret code
            const MAX_ATTEMPTS = 5;
            const LOCKOUT_DURATION_MS = 15 * 60 * 1000; // 15 minutes lockout
            const REDIRECT_URL = "beta.html"; 
            
            // --- LOCAL STORAGE KEYS ---
            const LS_UNLOCKED = 'premium_isUnlocked'; 
            const LS_ATTEMPTS = 'premium_attemptCount';
            const LS_LOCKOUT = 'premium_lockoutTimestamp';

            // --- DOM ELEMENTS ---
            const inputs = document.querySelectorAll('.code-input');
            const unlockButton = document.getElementById('unlockButton');
            const errorMessage = document.getElementById('error-message');
            // Added references for fade/animation
            const unlockScreen = document.getElementById('unlock-screen'); 
            const successOverlay = document.getElementById('success-overlay');

            let lockoutInterval = null;
            
            // =================================================================
            // === UTILITY FUNCTIONS ===========================================
            // =================================================================

            function checkInputs() {
                let allFilled = true;
                inputs.forEach(input => {
                    if (input.value.length === 0 || !/^\d$/.test(input.value)) {
                        allFilled = false;
                    }
                });
                const isLocked = isLockedOut();
                unlockButton.disabled = !allFilled || isLocked;
                
                if (allFilled && !isLocked) {
                    errorMessage.style.display = 'none';
                }
            }
            
            function isLockedOut() {
                const lockoutTimestamp = localStorage.getItem(LS_LOCKOUT);
                if (lockoutTimestamp) {
                    const now = new Date().getTime();
                    const lockoutEnd = parseInt(lockoutTimestamp) + LOCKOUT_DURATION_MS;
                    
                    if (now < lockoutEnd) {
                        const remainingTimeMs = lockoutEnd - now;
                        const totalSeconds = Math.ceil(remainingTimeMs / 1000);
                        const remainingMinutes = Math.floor(totalSeconds / 60);
                        const remainingSeconds = totalSeconds % 60;

                        errorMessage.textContent = `Too many failed attempts. Try again in ${remainingMinutes}:${remainingSeconds.toString().padStart(2, '0')}.`;
                        errorMessage.style.display = 'block';
                        errorMessage.style.color = '#dc3545'; 
                        return true;
                    } else {
                        localStorage.removeItem(LS_LOCKOUT);
                        localStorage.setItem(LS_ATTEMPTS, '0');
                        clearInterval(lockoutInterval);
                        lockoutInterval = null;
                        errorMessage.style.display = 'none';
                        return false;
                    }
                }
                return false;
            }
            
            function checkLockoutStatus() {
                if (isLockedOut()) {
                    unlockButton.disabled = true;
                    if (!lockoutInterval) {
                        lockoutInterval = setInterval(checkLockoutStatus, 1000); 
                    }
                } else {
                    if (lockoutInterval) {
                        clearInterval(lockoutInterval);
                        lockoutInterval = null;
                    }
                    checkInputs(); 
                }
            }
            
            /**
             * Logic run on successful PIN entry, performs animation then redirects.
             */
            function handleSuccess() {
                // 1. Store success state permanently
                localStorage.setItem(LS_UNLOCKED, 'true'); 
                localStorage.setItem(LS_ATTEMPTS, '0');
                localStorage.removeItem(LS_LOCKOUT);
                
                // 2. Hide the unlock screen with fade-out
                unlockScreen.classList.add('fade-out');
                
                // 3. Wait for fade-out to start (e.g., 500ms) then show the animated overlay
                setTimeout(() => {
                    unlockScreen.style.display = 'none'; // Ensure it's fully gone
                    successOverlay.style.display = 'flex'; // This triggers the CSS animation
                    
                    // 4. Redirect after animation time (1000ms delay after animation starts)
                    setTimeout(() => {
                        window.location.href = REDIRECT_URL;
                    }, 1000); 
                }, 500); // Matches the fade-out transition duration (0.5s)
            }

            /**
             * Logic run on failed PIN entry.
             */
            function handleFailure() {
                let currentAttempts = parseInt(localStorage.getItem(LS_ATTEMPTS) || '0');
                currentAttempts++;
                localStorage.setItem(LS_ATTEMPTS, currentAttempts.toString());
                
                if (currentAttempts >= MAX_ATTEMPTS) {
                    localStorage.setItem(LS_LOCKOUT, new Date().getTime().toString());
                    errorMessage.textContent = `Maximum attempts reached (${MAX_ATTEMPTS}). Access locked.`;
                    checkLockoutStatus(); 
                } else {
                    const remaining = MAX_ATTEMPTS - currentAttempts;
                    errorMessage.textContent = `Incorrect PIN. ${remaining} attempts remaining.`;
                    errorMessage.style.display = 'block';
                    errorMessage.style.color = '#dc3545'; 
                }
                
                // Reset inputs
                inputs.forEach(input => input.value = '');
                inputs[0].focus();
                unlockButton.disabled = true;
            }

            // =================================================================
            // === EVENT LISTENERS =============================================
            // =================================================================

            inputs.forEach((input, index) => {
                input.addEventListener('keyup', (e) => {
                    if (e.key === 'Backspace' && input.value === '') {
                        if (index > 0) inputs[index - 1].focus();
                    }
                    checkInputs();
                });
                
                input.addEventListener('input', () => {
                    let value = input.value.replace(/[^0-9]/g, '').charAt(0);
                    input.value = value;
                    
                    if (input.value.length === 1 && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    } else if (index === inputs.length - 1 && input.value.length === 1) {
                         unlockButton.focus(); 
                    }
                    checkInputs();
                });
                
                input.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const pasteCode = (e.clipboardData || window.clipboardData).getData('text').trim().replace(/[^0-9]/g, '').slice(0, 4);

                    for (let i = 0; i < pasteCode.length; i++) {
                        if (inputs[i]) inputs[i].value = pasteCode[i];
                    }

                    const lastFilledIndex = pasteCode.length > 0 ? pasteCode.length - 1 : 0;
                    if (inputs[lastFilledIndex + 1]) {
                        inputs[lastFilledIndex + 1].focus();
                    } else if (inputs[lastFilledIndex]) {
                        inputs[lastFilledIndex].blur();
                    }
                    checkInputs();
                });
            });

            unlockButton.addEventListener('click', () => {
                if (isLockedOut()) return;
                
                let enteredPin = Array.from(inputs).map(input => input.value).join('');

                if (enteredPin === CORRECT_PIN) {
                    handleSuccess();
                } else {
                    handleFailure();
                }
            });
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !unlockButton.disabled) {
                    e.preventDefault();
                    unlockButton.click();
                }
            });

            // =================================================================
            // === INITIALIZATION ==============================================
            // =================================================================

            document.addEventListener('DOMContentLoaded', () => {
                const isUnlocked = localStorage.getItem(LS_UNLOCKED);
                
                // Auto-redirect immediately if previously unlocked (new behavior)
                if (isUnlocked === 'true') {
                    window.location.href = REDIRECT_URL;
                } else {
                    checkLockoutStatus();
                }
            });
        })();
    </script>
</body>
</html>
