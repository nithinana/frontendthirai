<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Thirai</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body {
    margin: 0;
    font-family: Inter, sans-serif;
    background: #080808;
    color: #fff;
}

.section-title {
    padding: 20px;
    font-weight: 700;
    font-size: 18px;
}

.row-container {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 0 20px 20px;
}

.card {
    position: relative;
    width: 110px;
    aspect-ratio: 2/3;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
    cursor: pointer;
}

.card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Continue Watching remove button */
.remove-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    background: rgba(0,0,0,0.7);
    border: none;
    color: white;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    font-size: 14px;
    cursor: pointer;
    z-index: 5;
}
.remove-btn:hover {
    background: red;
}
</style>
</head>
<body>

<div class="section-title" id="cw-title" style="display:none;">Continue Watching</div>
<div class="row-container" id="continue-watching"></div>

<div class="section-title">Tamil</div>
<div class="row-container" id="row-tamil"></div>

<div class="section-title">Hindi</div>
<div class="row-container" id="row-hindi"></div>

<div class="section-title">Telugu</div>
<div class="row-container" id="row-telugu"></div>

<div class="section-title">Malayalam</div>
<div class="row-container" id="row-malayalam"></div>

<div class="section-title">Kannada</div>
<div class="row-container" id="row-kannada"></div>

<div class="section-title">Marathi</div>
<div class="row-container" id="row-marathi"></div>

<div class="section-title">Punjabi</div>
<div class="row-container" id="row-punjabi"></div>

<div class="section-title">Bengali</div>
<div class="row-container" id="row-bengali"></div>

<script>
/* ===============================
   CONTINUE WATCHING
================================ */
function loadContinueWatching() {
    const data = JSON.parse(localStorage.getItem("continueWatching") || "[]");
    const row = document.getElementById("continue-watching");
    const title = document.getElementById("cw-title");

    row.innerHTML = "";

    if (data.length === 0) {
        title.style.display = "none";
        return;
    }

    title.style.display = "block";

    data.forEach((movie, index) => {
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
            <button class="remove-btn" onclick="removeCW(${index})">âœ•</button>
            <img src="${movie.poster}" alt="">
        `;

        card.onclick = () => {
            window.location.href = movie.url;
        };

        row.appendChild(card);
    });
}

function removeCW(index) {
    let data = JSON.parse(localStorage.getItem("continueWatching") || "[]");
    data.splice(index, 1);
    localStorage.setItem("continueWatching", JSON.stringify(data));
    loadContinueWatching();
}

/* ===============================
   LOAD POPULAR MOVIES
================================ */
async function loadPopular(lang) {
    try {
        const res = await fetch(`/cache/${lang}popular.json`);
        const data = await res.json();
        const row = document.getElementById(`row-${lang}`);

        data.movies.forEach(movie => {
            const card = document.createElement("div");
            card.className = "card";

            card.innerHTML = `<img src="${movie.img_url}" alt="${movie.title}">`;

            card.onclick = () => {
                addToContinueWatching(movie);
                window.location.href = movie.page_url;
            };

            row.appendChild(card);
        });
    } catch (e) {
        console.error("Failed to load", lang, e);
    }
}

function addToContinueWatching(movie) {
    let data = JSON.parse(localStorage.getItem("continueWatching") || "[]");

    if (!data.find(m => m.url === movie.page_url)) {
        data.unshift({
            poster: movie.img_url,
            url: movie.page_url,
            title: movie.title
        });
        data = data.slice(0, 15);
        localStorage.setItem("continueWatching", JSON.stringify(data));
    }
}

/* ===============================
   INIT
================================ */
loadContinueWatching();

["tamil","hindi","telugu","malayalam","kannada","marathi","punjabi","bengali"]
    .forEach(loadPopular);
</script>

</body>
</html>
