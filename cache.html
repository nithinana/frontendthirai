<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HKV7GQ766F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HKV7GQ766F');
</script>


    <meta charset="UTF-8">
    <title>Thirai API Cache Warmer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background-color: #f8f9fa;
            color: #212529;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
        }
        h1 {
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 0.5em;
        }
        #log-container {
            font-family: "Courier New", Courier, monospace;
            background-color: #e9ecef;
            padding: 1em;
            border-radius: 5px;
            margin-top: 1em;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.9em;
        }
        .log { margin: 0.3em 0; }
        .success { color: #198754; }
        .error { color: #dc3545; }
        #summary {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 1.5em;
            padding: 0.8em;
            border-radius: 5px;
        }
        .summary-success { background-color: #d1e7dd; color: #0f5132; }
        .summary-fail { background-color: #f8d7da; color: #842029; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Thirai API Cache Warmer</h1>
        <p>Sending requests to warm up the API cache for the main page.</p>
        <div id="log-container"></div>
        <p id="summary"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const logContainer = document.getElementById('log-container');
            const summaryElement = document.getElementById('summary');

            // --- Configuration ---
            const API_BASE_URLS = ['https://thiraibackend.onrender.com', 'https://backendthirai-test.onrender.com'];
            const LANGUAGES = ['tamil', 'hindi', 'telugu', 'malayalam', 'kannada', 'bengali', 'marathi', 'punjabi'];
            const PAGES_TO_WARM = [1, 2];

            /**
             * Generates the list of API URLs to fetch based on specific rules for each endpoint.
             */
            const urlsToFetch = [];
            for (const baseUrl of API_BASE_URLS) {
                let categoriesForThisUrl = [];

                // Assign categories based on the base URL
                if (baseUrl === 'https://thiraibackend.onrender.com') {
                    categoriesForThisUrl = ['popular'];
                } else if (baseUrl === 'https://backendthirai-test.onrender.com') {
                    categoriesForThisUrl = ['popular', 'recent'];
                }

                // Build the URLs for the assigned categories
                for (const lang of LANGUAGES) {
                    for (const category of categoriesForThisUrl) {
                        for (const page of PAGES_TO_WARM) {
                            urlsToFetch.push(`${baseUrl}/language/${lang}?category=${category}&page=${page}`);
                        }
                    }
                }
            }

            /**
             * Logs a message to the on-screen console.
             * @param {string} message - The message to log.
             * @param {string} className - The CSS class for styling ('success', 'error', or '').
             */
            function logMessage(message, className) {
                const p = document.createElement('p');
                p.textContent = message;
                p.className = `log ${className}`;
                logContainer.appendChild(p);
                logContainer.scrollTop = logContainer.scrollHeight; // Auto-scroll
            }

            /**
             * Sends a single GET request to a URL and logs the result.
             * @param {string} url - The URL to fetch.
             * @returns {Promise<object>} A promise that resolves with the status.
             */
            async function sendRequest(url) {
                try {
                    const response = await fetch(url, { mode: 'cors' });
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    logMessage(`✅ SUCCESS [${response.status}]: ${url}`, 'success');
                    return { status: 'fulfilled', url };
                } catch (error) {
                    logMessage(`❌ FAILED: ${url} (Error: ${error.message})`, 'error');
                    return { status: 'rejected', url, reason: error.message };
                }
            }

            /**
             * Main function to trigger all cache warming requests.
             */
            async function warmAllCaches() {
                logMessage('Starting cache warming process...', '');
                
                // Create an array of promises, one for each request
                const promises = urlsToFetch.map(url => sendRequest(url));
                
                // Wait for all requests to complete (either success or failure)
                const results = await Promise.allSettled(promises);

                const successfulRequests = results.filter(r => r.status === 'fulfilled' && r.value.status === 'fulfilled').length;
                const failedRequests = results.length - successfulRequests;
                
                // Display the final summary
                summaryElement.textContent = `Process Complete. Successful Requests: ${successfulRequests}, Failed Requests: ${failedRequests}.`;
                if (failedRequests > 0) {
                    summaryElement.className = 'summary-fail';
                } else {
                    summaryElement.className = 'summary-success';
                }
            }

            // Run the main function
            warmAllCaches();
        });
    </script>

</body>
</html>
