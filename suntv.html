<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HKV7GQ766F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-HKV7GQ766F');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Sun TV HDR - Thirai</title>
    <link rel="icon" type="image/png" href="/static/favicon.png"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
    
    <style>
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: black;
            font-family: 'Inter', sans-serif;
            -webkit-user-select: none; user-select: none;
        }
        .video-player-wrapper {
            position: relative; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            background-color: black;
        }
        #moviePlayer {
            transform: scale(1); transform-origin: center center;
            transition: transform 0.3s ease-in-out;
            position: relative; width: 100%; height: 100%;
            object-fit: contain; display: block;
        }
        video::-webkit-media-controls { display: none !important; }
        .custom-controls-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: space-between;
            align-items: center; background: rgba(0, 0, 0, 0.4);
            opacity: 0; transition: opacity 0.3s ease;
            z-index: 10; pointer-events: none;
        }
        .custom-controls-overlay.visible { opacity: 1; pointer-events: auto; }
        .top-controls {
            width: 100%; display: flex; justify-content: space-between;
            align-items: center; padding: 1.5rem 1.5rem 1rem; box-sizing: border-box;
        }
        .movie-title-display {
            color: white; font-size: 1.2rem; font-weight: bold;
            text-align: center; flex-grow: 1; margin: 0 1rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            line-height: 1; display: flex; align-items: center; justify-content: center; height: 1.5rem;
        }
        .center-controls { display: flex; align-items: center; gap: 2rem; }
        .bottom-controls {
            width: 100%; padding: 1rem 1.5rem 2rem; box-sizing: border-box;
            display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 1rem;
        }
        .control-button {
            background: rgba(255, 255, 255, 0.2); border: none; color: white;
            font-size: 2.2rem; cursor: pointer; padding: 0.8rem; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            transition: background 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); -webkit-tap-highlight-color: transparent;
        }
        #playPauseButton { font-size: 3.5rem; padding: 1.2rem; }
        .progress-bar-container {
            flex-grow: 1; height: 8px; background-color: rgba(255, 255, 255, 0.3);
            border-radius: 10px; cursor: grab; position: relative; margin: 0 1rem;
        }
        .progress-bar { height: 100%; width: 0%; background-color: #0d6efd; border-radius: 10px; transition: width 0.1s linear; }
        .progress-bar-handle {
            position: absolute; top: 50%; left: 0%; transform: translate(-50%, -50%);
            width: 20px; height: 20px; background-color: white; border-radius: 50%;
            display: none; box-shadow: 0 0 8px rgba(0,0,0,0.6);
        }
        .progress-bar-container:hover .progress-bar-handle, .progress-bar-container.dragging .progress-bar-handle { display: block; }
        .spinner-border {
            width: 2rem; height: 2rem; color: white; border: 0.25em solid currentColor;
            border-right-color: transparent; border-radius: 50%; animation: spinner-border .75s linear infinite; display: inline-block;
        }
        @keyframes spinner-border { to { transform: rotate(360deg); } }
        .top-button {
            background: transparent; border: none; color: white; font-size: 1.5rem;
            padding: 0.7rem 1rem; border-radius: 0.5rem; cursor: pointer; display: flex; align-items: center;
        }
        #fullscreenButton { background: transparent; box-shadow: none; font-size: 1.8rem; }
    </style>
</head>
<body>
    <div class="video-player-wrapper" id="videoPlayerWrapper">
        <video id="moviePlayer" playsinline webkit-playsinline preload="auto" autoplay></video>

        <div class="custom-controls-overlay" id="customControlsOverlay">
            <div class="top-controls">
                <button id="backButton" class="top-button"><i class="bi bi-arrow-left"></i></button>
                <div class="movie-title-display" id="movieTitleDisplay">Sun TV HDR Live</div>
                <button id="magnificationButton" class="top-button"><i class="bi bi-zoom-in"></i></button>
                <button id="castButton" class="top-button" style="display: none;"><i class="bi bi-cast"></i></button>
            </div>

            <div class="center-controls">
                <button id="rewindButton" class="control-button"><i class="bi bi-arrow-counterclockwise"></i></button>
                <button id="playPauseButton" class="control-button">
                    <i class="bi bi-play-fill" id="playIcon"></i>
                    <div class="spinner-border" id="loadingSpinner" role="status" style="display: none;"></div>
                </button>
                <button id="forwardButton" class="control-button"><i class="bi bi-arrow-clockwise"></i></button>
            </div>

            <div class="bottom-controls">
                <div class="progress-bar-container" id="progressBarContainer">
                    <div class="progress-bar" id="progressBar"></div>
                    <div class="progress-bar-handle" id="progressBarHandle"></div>
                </div>
                <button id="fullscreenButton" class="control-button"><i class="bi bi-arrows-fullscreen"></i></button>
            </div>
        </div>
    </div>

    <script>
        const moviePlayer = document.getElementById('moviePlayer');
        const customControlsOverlay = document.getElementById('customControlsOverlay');
        const playPauseButton = document.getElementById('playPauseButton');
        const playIcon = document.getElementById('playIcon');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const rewindButton = document.getElementById('rewindButton');
        const forwardButton = document.getElementById('forwardButton');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBar = document.getElementById('progressBar');
        const progressBarHandle = document.getElementById('progressBarHandle');
        const backButton = document.getElementById('backButton');
        const videoPlayerWrapper = document.getElementById('videoPlayerWrapper');
        const fullscreenButton = document.getElementById('fullscreenButton');
        const magnificationButton = document.getElementById('magnificationButton');
        const magnificationIcon = magnificationButton.querySelector('i');

        let zoomLevel = 1;
        let controlsTimeout;
        const FADE_TIMEOUT_SECONDS = 7;
        const SEEK_TIME = 10;

        // NEW STREAM LINK
        const LIVE_LINK = "https://livestream10.sunnxt.com/DolbyVision/SunTV_HDR/SunTV_HDR_Endpoints/SunTV-HDR10-IN-index.m3u8";

        function showControls() {
            customControlsOverlay.classList.add('visible');
            clearTimeout(controlsTimeout);
            if (!moviePlayer.paused) {
                controlsTimeout = setTimeout(() => customControlsOverlay.classList.remove('visible'), FADE_TIMEOUT_SECONDS * 1000);
            }
        }

        function toggleControls() {
            customControlsOverlay.classList.contains('visible') ? customControlsOverlay.classList.remove('visible') : showControls();
        }

        // Initialize Video with HLS support
        function loadStream() {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(LIVE_LINK);
                hls.attachMedia(moviePlayer);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    moviePlayer.play().catch(() => showControls());
                });
            } 
            else if (moviePlayer.canPlayType('application/vnd.apple.mpegurl')) {
                // For Safari/iOS native support
                moviePlayer.src = LIVE_LINK;
                moviePlayer.addEventListener('loadedmetadata', function() {
                    moviePlayer.play().catch(() => showControls());
                });
            }
        }

        // Control Listeners
        playPauseButton.addEventListener('click', () => moviePlayer.paused ? moviePlayer.play() : moviePlayer.pause());
        rewindButton.addEventListener('click', () => moviePlayer.currentTime -= SEEK_TIME);
        forwardButton.addEventListener('click', () => moviePlayer.currentTime += SEEK_TIME);
        backButton.addEventListener('click', () => window.history.back());
        
        moviePlayer.addEventListener('waiting', () => {
            loadingSpinner.style.display = 'block';
            playIcon.style.display = 'none';
        });

        moviePlayer.addEventListener('playing', () => {
            loadingSpinner.style.display = 'none';
            playIcon.style.display = 'block';
            playIcon.className = 'bi bi-pause-fill';
            showControls();
        });

        moviePlayer.addEventListener('pause', () => {
            playIcon.className = 'bi bi-play-fill';
            showControls();
        });

        moviePlayer.addEventListener('timeupdate', () => {
            if (!isNaN(moviePlayer.duration)) {
                const progress = (moviePlayer.currentTime / moviePlayer.duration) * 100;
                progressBar.style.width = `${progress}%`;
                progressBarHandle.style.left = `${progress}%`;
            }
        });

        magnificationButton.addEventListener('click', () => {
            zoomLevel = (zoomLevel + 1) % 3;
            if(zoomLevel === 0) { 
                moviePlayer.style.transform = 'scale(0.9)'; 
                magnificationIcon.className = 'bi bi-zoom-out'; 
            } else if(zoomLevel === 1) { 
                moviePlayer.style.transform = 'scale(1)'; 
                magnificationIcon.className = 'bi bi-zoom-in'; 
            } else { 
                moviePlayer.style.transform = 'scale(1.2)'; 
                magnificationIcon.className = 'bi bi-search'; 
            }
        });

        fullscreenButton.addEventListener('click', () => {
            if (!document.fullscreenElement) videoPlayerWrapper.requestFullscreen();
            else document.exitFullscreen();
        });

        videoPlayerWrapper.addEventListener('click', (e) => {
            if (!e.target.closest('.control-button, .top-button, .progress-bar-container')) toggleControls();
        });

        document.addEventListener('DOMContentLoaded', () => {
            loadStream();
            showControls();
        });
    </script>
</body>
</html>
