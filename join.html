<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thirai</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
    <style>
        body {
            background-color: #f8f9fa;
            color: #212529;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            flex-direction: column;
            position: relative;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        #toggleDarkMode {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 0.375rem;
            padding: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
            width: 2.5rem;
            height: 2.5rem;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        #toggleDarkMode:hover {
            background-color: #555;
        }

        #modeIcon {
            font-size: 1.25rem;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #212529;
            font-size: 24px;
            text-decoration: none;
            cursor: pointer;
            z-index: 10;
            padding: 10px;
            background-color: transparent;
            border-radius: 8px;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        body.dark-mode .back-button {
            color: #e0e0e0;
        }

        .back-button:hover {
            background-color: #f0f0f0;
            color: #212529;
        }
        
        body.dark-mode .back-button:hover {
            background-color: #333;
            color: #fff;
        }

        .container {
            text-align: center;
            background-color: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 400px;
            transition: background-color 0.5s ease, box-shadow 0.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        body.dark-mode .container {
            background-color: #111;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #logo {
            display: block;
            max-width: 175px;
            height: auto;
            margin-bottom: 12x;
        }

        h2 {
            font-size: 1.5em;
            margin-bottom: 25px;
        }
        
        body.dark-mode h2 {
            color: #ffffff;
        }

        .code-input-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .code-input {
            width: 40px;
            height: 50px;
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            color: #212529;
            background-color: #f0f0f0;
            border: 2px solid #ccc;
            border-radius: 8px;
            -webkit-appearance: none;
            -moz-appearance: textfield;
            outline: none;
            transition: border-color 0.2s ease, background-color 0.5s ease, color 0.5s ease;
        }
        
        body.dark-mode .code-input {
            color: #fff;
            background-color: #222;
            border: 2px solid #333;
        }

        .code-input:focus {
            border-color: #0d6efd;
        }

        .code-input::-webkit-outer-spin-button,
        .code-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input::-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #f0f0f0 inset !important;
            -webkit-text-fill-color: #212529 !important;
        }
        
        body.dark-mode input::-webkit-autofill,
        body.dark-mode input:-webkit-autofill:hover,
        body.dark-mode input:-webkit-autofill:focus,
        body.dark-mode input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #222 inset !important;
            -webkit-text-fill-color: #fff !important;
        }

        .join-button {
            width: 100%;
            padding: 15px;
            background-color: #0d6efd;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-bottom: 25px;
        }

        .join-button:hover {
            background-color: #0b5ed7;
        }

        .join-button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        #error-message {
            color: #dc3545;
            font-size: 0.9em;
            display: none;
            margin-top: 25px;
        }
    </style>
</head>
<body>
    <button id="toggleDarkMode" aria-label="Toggle dark mode" title="Toggle dark mode">
        <i id="modeIcon" class="bi bi-moon-fill"></i>
    </button>
    <a href="javascript:history.back()" class="back-button" aria-label="Go back">
        <i class="bi bi-arrow-left"></i>
    </a>
    <div class="container">
        <img id="logo" src="./static/thiraiblack.png" alt="Thirai Logo">
        <h2>Enter the channel code</h2>
        <div class="code-input-container" id="codeInputContainer">
            <input type="text" class="code-input" id="code1" maxlength="1" pattern="[A-Z0-9]" inputmode="numeric" autocomplete="off">
            <input type="text" class="code-input" id="code2" maxlength="1" pattern="[A-Z0-9]" inputmode="numeric" autocomplete="off">
            <input type="text" class="code-input" id="code3" maxlength="1" pattern="[A-Z0-9]" inputmode="numeric" autocomplete="off">
            <input type="text" class="code-input" id="code4" maxlength="1" pattern="[A-Z0-9]" inputmode="numeric" autocomplete="off">
        </div>
        <button class="join-button" id="joinButton" disabled>Join</button>
        <div id="error-message"></div>
    </div>

    <script>
        const inputs = document.querySelectorAll('.code-input');
        const joinButton = document.getElementById('joinButton');
        const errorMessage = document.getElementById('error-message');
        const toggleButton = document.getElementById('toggleDarkMode');
        const body = document.body;
        const modeIcon = document.getElementById('modeIcon');
        const logo = document.getElementById('logo');

        function updateLogo(isDarkMode) {
            logo.src = isDarkMode ? "./static/thiraiwhite.png" : "./static/thiraiblack.png";
        }

        function updateIcon(isDarkMode) {
            if (isDarkMode) {
                modeIcon.classList.remove('bi-moon-fill');
                modeIcon.classList.add('bi-sun-fill');
            } else {
                modeIcon.classList.remove('bi-sun-fill');
                modeIcon.classList.add('bi-moon-fill');
            }
        }

        function applyTheme(theme) {
            if (theme === 'dark') {
                body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            } else if (theme === 'light') {
                body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            } else {
                localStorage.removeItem('theme');
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    body.classList.add('dark-mode');
                } else {
                    body.classList.remove('dark-mode');
                }
            }
            updateIcon(body.classList.contains('dark-mode'));
            updateLogo(body.classList.contains('dark-mode'));
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            applyTheme(savedTheme || 'system');
        });

        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (!localStorage.getItem('theme')) {
                    applyTheme('system');
                }
            });
        }

        toggleButton.addEventListener('click', () => {
            const currentTheme = localStorage.getItem('theme');
            applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });

        inputs.forEach((input, index) => {
            input.addEventListener('keyup', (e) => {
                if (e.key.length === 1 && /[A-Z0-9]/.test(e.key.toUpperCase())) {
                    input.value = e.key.toUpperCase();
                    if (index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                }

                if (e.key === 'Backspace' && input.value === '') {
                    if (index > 0) {
                        inputs[index - 1].focus();
                    }
                }

                checkInputs();
            });
            
            input.addEventListener('input', () => {
                if (input.value.length > 1) {
                    input.value = input.value.charAt(0);
                }
            });
        });

        function checkInputs() {
            let allFilled = true;
            inputs.forEach(input => {
                if (input.value.length === 0) {
                    allFilled = false;
                }
            });
            joinButton.disabled = !allFilled;
            if (allFilled) {
                errorMessage.style.display = 'none';
            }
        }

        joinButton.addEventListener('click', () => {
            let filmCode = '';
            inputs.forEach(input => {
                filmCode += input.value.toUpperCase();
            });

            if (filmCode.length === 4) {
                window.location.href = `watch.html?film=${filmCode}`;
            } else {
                errorMessage.textContent = 'Please enter a 4-character code.';
                errorMessage.style.display = 'block';
            }
        });
    </script>
</body>
</html>